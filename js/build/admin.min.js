!function(e){"use strict";window.WellKnownFileManager=window.WellKnownFileManager||{},e.extend(window.WellKnownFileManager,{constructor(){this.nonce=window.WellKnownFileManager.nonce,this.bindEvents()},bindEvents(){e(".well-known-file-toggle").on("change",this.handleToggle.bind(this)),e(".save-file-content").on("click",this.handleSave.bind(this)),e(".restore-default-content").on("click",this.handleRestore.bind(this)),e(".well-known-file-content textarea").on("input",this.handleContentChange.bind(this))},handleContentChange(n){e(n.target).closest(".well-known-file-card")},showSaveNotice(n,t){n.find(".card-notice.save").remove();const o=e("<div>",{class:"card-notice success save",text:t});n.append(o),setTimeout((()=>{o.fadeOut(300,(function(){e(this).remove()}))}),3e3)},handleSave(n){const t=e(n.target).closest(".save-file-content"),o=t.closest(".well-known-file-card"),s=o.find(".well-known-file-content textarea"),a=o.find(".well-known-file-toggle"),l=o.find(".well-known-file-response-code-input"),i=o.data("file-id");if(o.hasClass("saving"))return;o.addClass("saving"),t.prop("disabled",!0);const d=s.val();this.saveFileContent(i,d,a.is(":checked"),l.val()).then((()=>{o.removeClass("saving"),t.prop("disabled",!1)})).catch((()=>{o.removeClass("saving"),t.prop("disabled",!1)}))},handleToggle(n){const t=e(n.target),o=t.closest(".well-known-file-card"),s=o.find(".well-known-file-content textarea"),a=o.find(".well-known-file-response-code-input"),l=o.data("file-id");if(o.hasClass("saving"))return;o.addClass("saving"),t.prop("disabled",!0);const i=s.val();t.is(":checked")?s.prop("disabled",!1):s.prop("disabled",!0),this.saveFileContent(l,i,t.is(":checked"),a.val()).then((()=>{o.removeClass("saving"),t.prop("disabled",!1)})).catch((()=>{o.removeClass("saving"),t.prop("disabled",!1)}))},handleRestore(n){const t=e(n.target).closest(".restore-default-content"),o=t.closest(".well-known-file-card"),s=o.find(".well-known-file-content textarea"),a=o.data("file-id");o.hasClass("saving")||(o.addClass("saving"),t.prop("disabled",!0),e.ajax({url:ajaxurl,type:"POST",data:{action:"well_known_file_get_default_content",file_id:a,nonce:window.WellKnownFileManager.nonce},success:e=>{e.success?(s.val(e.data.content),this.saveFileContent(a,e.data.content,!0,e.data.response_code).then((()=>{this.showNotice(o,"success","Default content restored and saved.")})).catch((()=>{this.showNotice(o,"error","Failed to save restored content.")}))):this.showNotice(o,"error","Failed to restore default content.")},error:()=>{this.showNotice(o,"error","Failed to restore default content.")},complete:()=>{o.removeClass("saving"),t.prop("disabled",!1)}}))},saveFileContent(n,t,o,s){return console.log("Sending nonce:",window.WellKnownFileManager.nonce),e.ajax({url:ajaxurl,type:"POST",data:{action:"well_known_file_manager_save_file",nonce:window.WellKnownFileManager.nonce,file:n,content:t,status:o,response_code:s}}).then((t=>{if(!t.success)throw new Error(t.data.message);{const s=e(`.well-known-file-card[data-file-id="${n}"]`),a=s.find(".well-known-file-content textarea"),l=(s.find(".well-known-file-toggle"),s.find(".button"));o?(s.removeClass("disabled"),a.prop("disabled",!1),l.prop("disabled",!1)):(s.addClass("disabled"),a.prop("disabled",!0),l.prop("disabled",!0)),this.showSaveNotice(s,t.data.message)}}))},showCardNotice(n,t,o){n.find(".card-notice").remove();const s=e("<div>",{class:`card-notice ${t}`,text:o});n.append(s),setTimeout((()=>{s.fadeOut(300,(function(){e(this).remove()}))}),3e3)},showNotice(e,n="success"){const t=document.createElement("div");t.className=`notice notice-${n} is-dismissible`,t.innerHTML=`<p>${e}</p>`;const o=document.querySelector(".wrap");o.insertBefore(t,o.firstChild),setTimeout((()=>{t.remove()}),5e3)}}),e(document).ready((function(){window.WellKnownFileManager.constructor()}))}(jQuery);