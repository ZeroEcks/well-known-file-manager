!function(e){"use strict";window.WellKnownFileManager=window.WellKnownFileManager||{},e.extend(window.WellKnownFileManager,{constructor(){this.nonce=window.WellKnownFileManager.nonce,this.bindEvents()},bindEvents(){e(".well-known-file-toggle").on("change",this.handleToggle.bind(this)),e(".save-file-content").on("click",this.handleSave.bind(this)),e(".restore-default-content").on("click",this.handleRestore.bind(this)),e(".well-known-file-content textarea").on("input",this.handleContentChange.bind(this))},handleContentChange(n){e(n.target).closest(".well-known-file-card")},showSaveNotice(n,t){n.find(".card-notice.save").remove();const a=e("<div>",{class:"card-notice success save",text:t});n.append(a),setTimeout((()=>{a.fadeOut(300,(function(){e(this).remove()}))}),3e3)},handleSave(n){const t=e(n.target).closest(".save-file-content"),a=t.closest(".well-known-file-card"),o=a.find(".well-known-file-content textarea"),s=a.find(".well-known-file-toggle"),l=a.find(".well-known-file-response-code-input"),i=a.data("file-id");if(a.hasClass("saving"))return;a.addClass("saving"),t.prop("disabled",!0);const d=o.val();this.saveFileContent(i,d,s.is(":checked"),l.val()).then((()=>{a.removeClass("saving"),t.prop("disabled",!1)})).catch((()=>{a.removeClass("saving"),t.prop("disabled",!1)}))},handleToggle(n){const t=e(n.target),a=t.closest(".well-known-file-card"),o=a.find(".well-known-file-content textarea"),s=a.find(".well-known-file-response-code-input"),l=a.data("file-id");if(a.hasClass("saving"))return;a.addClass("saving"),t.prop("disabled",!0);const i=o.val();t.is(":checked")?o.prop("disabled",!1):o.prop("disabled",!0),this.saveFileContent(l,i,t.is(":checked"),s.val()).then((()=>{a.removeClass("saving"),t.prop("disabled",!1)})).catch((()=>{a.removeClass("saving"),t.prop("disabled",!1)}))},handleRestore(n){const t=e(n.target).closest(".restore-default-content"),a=t.closest(".well-known-file-card"),o=a.find(".well-known-file-content textarea"),s=a.data("file-id");a.hasClass("saving")||(a.addClass("saving"),t.prop("disabled",!0),e.ajax({url:WellKnownFileManager.ajaxurl,type:"POST",data:{action:"wkfm_get_default_content",file_id:s,nonce:WellKnownFileManager.nonce},success:e=>{e.success?(o.val(e.data.content),this.saveFileContent(s,e.data.content,!0,e.data.response_code).then((()=>{this.showNotice(a,"success","Default content restored and saved.")})).catch((()=>{this.showNotice(a,"error","Failed to save restored content.")}))):this.showNotice(a,"error","Failed to restore default content.")},error:()=>{this.showNotice(a,"error","Failed to restore default content.")},complete:()=>{a.removeClass("saving"),t.prop("disabled",!1)}}))},saveFileContent(n,t,a,o){return console.log("Sending nonce:",window.WellKnownFileManager.nonce),e.ajax({url:WellKnownFileManager.ajaxurl,type:"POST",data:{action:"wkfm_save_file",nonce:WellKnownFileManager.nonce,file:n,content:t,status:a,response_code:o}}).then((t=>{if(!t.success)throw new Error(t.data.message);{const o=e(`.well-known-file-card[data-file-id="${n}"]`),s=o.find(".well-known-file-content textarea"),l=(o.find(".well-known-file-toggle"),o.find(".button"));a?(o.removeClass("disabled"),s.prop("disabled",!1),l.prop("disabled",!1)):(o.addClass("disabled"),s.prop("disabled",!0),l.prop("disabled",!0)),this.showSaveNotice(o,t.data.message)}}))},showCardNotice(n,t,a){n.find(".card-notice").remove();const o=e("<div>",{class:`card-notice ${t}`,text:a});n.append(o),setTimeout((()=>{o.fadeOut(300,(function(){e(this).remove()}))}),3e3)},showNotice(e,n){const t=document.createElement("div");t.className=`notice notice-${e} is-dismissible`,t.innerHTML=`<p>${n}</p>`;const a=document.querySelector(".well-known-file-manager-admin");a&&(a.insertBefore(t,a.firstChild),setTimeout((()=>{t.parentNode&&t.remove()}),5e3))}}),e(document).ready((function(){window.WellKnownFileManager.constructor()}))}(jQuery);