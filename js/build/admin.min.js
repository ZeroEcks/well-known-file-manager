!function(e){"use strict";const t={nonce:"",constructor(){this.nonce=wellKnownManager.nonce,this.bindEvents()},bindEvents(){e(".well-known-file-toggle").on("change",this.handleToggle.bind(this)),e(".save-file-content").on("click",this.handleSave.bind(this)),e(".restore-default-content").on("click",this.handleRestore.bind(this)),e(".well-known-file-content textarea").on("input",this.handleContentChange.bind(this))},handleContentChange(t){e(t.target).closest(".well-known-file-card")},showSaveNotice(t,n){t.find(".card-notice.save").remove();const s=e("<div>",{class:"card-notice success save",text:n});t.append(s),setTimeout((()=>{s.fadeOut(300,(function(){e(this).remove()}))}),3e3)},handleSave(t){const n=e(t.target).closest(".save-file-content"),s=n.closest(".well-known-file-card"),a=s.find(".well-known-file-content textarea"),o=s.find(".well-known-file-toggle"),i=s.find(".well-known-file-response-code-input"),l=s.data("file-id");if(s.hasClass("saving"))return;s.addClass("saving"),n.prop("disabled",!0);const d=a.val();this.saveFileContent(l,d,o.is(":checked"),i.val()).then((()=>{s.removeClass("saving"),n.prop("disabled",!1)})).catch((()=>{s.removeClass("saving"),n.prop("disabled",!1)}))},handleToggle(t){const n=e(t.target),s=n.closest(".well-known-file-card"),a=s.find(".well-known-file-content textarea"),o=s.find(".well-known-file-response-code-input"),i=s.data("file-id");if(s.hasClass("saving"))return;s.addClass("saving"),n.prop("disabled",!0);const l=a.val();n.is(":checked")?a.prop("disabled",!1):a.prop("disabled",!0),this.saveFileContent(i,l,n.is(":checked"),o.val()).then((()=>{s.removeClass("saving"),n.prop("disabled",!1)})).catch((()=>{s.removeClass("saving"),n.prop("disabled",!1)}))},handleRestore(t){const n=e(t.target).closest(".restore-default-content"),s=n.closest(".well-known-file-card"),a=s.find(".well-known-file-content textarea"),o=s.data("file-id");s.hasClass("saving")||(s.addClass("saving"),n.prop("disabled",!0),e.ajax({url:ajaxurl,type:"POST",data:{action:"well_known_get_default_content",file_id:o,nonce:this.nonce},success:e=>{e.success?(a.val(e.data.content),this.saveFileContent(o,e.data.content,!0,e.data.response_code).then((()=>{this.showNotice(s,"success","Default content restored and saved.")})).catch((()=>{this.showNotice(s,"error","Failed to save restored content.")}))):this.showNotice(s,"error","Failed to restore default content.")},error:()=>{this.showNotice(s,"error","Failed to restore default content.")},complete:()=>{s.removeClass("saving"),n.prop("disabled",!1)}}))},saveFileContent(t,n,s,a){return e.ajax({url:wellKnownManager.ajaxurl,type:"POST",data:{action:"well_known_manager_save_file",nonce:this.nonce,file:t,content:n,status:s,response_code:a}}).then((n=>{if(!n.success)throw new Error(n.data.message);{const a=e(`.well-known-file-card[data-file-id="${t}"]`),o=a.find(".well-known-file-content textarea"),i=(a.find(".well-known-file-toggle"),a.find(".button"));s?(a.removeClass("disabled"),o.prop("disabled",!1),i.prop("disabled",!1)):(a.addClass("disabled"),o.prop("disabled",!0),i.prop("disabled",!0)),this.showSaveNotice(a,n.data.message)}}))},showCardNotice(t,n,s){t.find(".card-notice").remove();const a=e("<div>",{class:`card-notice ${n}`,text:s});t.append(a),setTimeout((()=>{a.fadeOut(300,(function(){e(this).remove()}))}),3e3)},showNotice(e,t="success"){const n=document.createElement("div");n.className=`notice notice-${t} is-dismissible`,n.innerHTML=`<p>${e}</p>`;const s=document.querySelector(".wrap");s.insertBefore(n,s.firstChild),setTimeout((()=>{n.remove()}),5e3)}};e(document).ready((function(){t.constructor()}))}(jQuery);